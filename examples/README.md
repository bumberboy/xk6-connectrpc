# xk6-connectrpc Examples

This folder contains example k6 scripts demonstrating how to use the xk6-connectrpc extension.

## ⚠️ Important Notice

**The `protoc-gen-k6-connectrpc` plugin is currently broken and not functional.** We are actively looking for volunteers to help fix it. If you're interested in contributing, please check our GitHub issues or reach out to the maintainers.

**For now, please use the raw xk6-connectrpc API examples** (unary-example.js, streaming-example.js, etc.) which are fully functional.

## Prerequisites

1. Build k6 with the connectrpc extension:
   ```bash
   xk6 build --with github.com/bumberboy/xk6-connectrpc@latest
   ```

## Examples

### ~~1. Generated Client Example (`generated-client-example.js`)~~ ❌ **Currently Broken**

~~Demonstrates using clients generated by `protoc-gen-k6-connectrpc` with the Eliza service from buf schema registry.~~

**⚠️ This example is currently non-functional due to issues with the protoc-gen-k6-connectrpc plugin.**

### 1. Unary RPC Calls (`unary-example.js`) ✅ **Working**

Demonstrates basic unary RPC calls using the raw xk6-connectrpc API with manual proto loading.

**Run:**
```bash
./k6 run examples/unary-example.js
```

**Features:**
- Connection establishment
- Single request-response calls
- Response validation
- Metrics collection

### 2. Bidirectional Streaming (`streaming-example.js`) ✅ **Working**

Shows how to use bidirectional streaming with the raw xk6-connectrpc API.

**Run:**
```bash
./k6 run examples/streaming-example.js
```

**Features:**
- Bidirectional streaming
- Event-driven message handling
- Stream lifecycle management
- Async/await patterns

### 3. Full Integration Test (`test-connectrpc-clown.js`) ✅ **Working**

Comprehensive example that tests both unary and streaming operations with detailed metrics using custom proto files.

**Run:**
```bash
./k6 run examples/test-connectrpc-clown.js
```

**Features:**
- Multiple test scenarios
- Comprehensive metrics and thresholds
- Connection reuse patterns
- Error handling

## Current Approach: Raw API Only

Due to the current issues with the code generation plugin, you should use the raw xk6-connectrpc API:

**Pros:**
- ✅ Fully functional and tested
- ✅ Full control over connection and call parameters
- ✅ Works with any proto files
- ✅ No broken dependencies

**Cons:**
- ❌ Manual proto loading required
- ❌ Manual method path construction
- ❌ More boilerplate code

**Working Examples:** `unary-example.js`, `streaming-example.js`, `test-connectrpc-clown.js`

## Customizing Examples

### For Raw API Examples:
1. Replace `clown.proto` with your own proto file
2. Update the service URLs in the scripts
3. Modify the RPC method names and message structures
4. Adjust the test thresholds based on your performance requirements

## Protocol and Content Type Combinations

These examples can be easily modified to test different protocol combinations:

- **Connect + JSON**: `protocol: 'connect', contentType: 'application/json'`
- **Connect + Protobuf**: `protocol: 'connect', contentType: 'application/proto'`
- **gRPC + Protobuf**: `protocol: 'grpc', contentType: 'application/protobuf'`
- **gRPC-Web + JSON**: `protocol: 'grpc-web', contentType: 'application/json'`

## Contributing

**Help Wanted:** We need volunteers to fix the protoc-gen-k6-connectrpc plugin! If you have experience with:
- Protocol Buffers and protoc plugins
- JavaScript/TypeScript code generation
- k6 extension development

Please consider contributing to get the code generation functionality working again. 